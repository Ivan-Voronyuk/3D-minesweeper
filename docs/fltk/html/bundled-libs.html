<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fltk: Developer info for bundled libs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">fltk
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="FLTK-devel.html">Development of the FLTK library</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Developer info for bundled libs</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This chapter details the procedure to update the libraries which are bundled inside FLTK.</p>
<h1><a class="anchor" id="bundled-intro"></a>
Introduction</h1>
<p>This file is mainly intended for FLTK developers and contains information about the current versions of all bundled libraries and about how to upgrade these bundled libraries.</p>
<p>Starting with FLTK 1.4.0 the bundled libraries jpeg, png, and zlib use "symbol prefixing" with the prefix 'fltk_' for all external symbols to distinguish the bundled libraries from existing system libraries and to avoid runtime errors.</p>
<p>User code compiled correctly with the header files provided by the bundled image libraries need not be changed.</p>
<p>The nanosvg library is not affected.</p>
<h1><a class="anchor" id="bundled-status"></a>
Current status</h1>
<div class="fragment"><div class="line">Current versions of bundled libraries (as of June 1, 2024):</div>
<div class="line">  Library       Version/git commit Release date         FLTK Version</div>
<div class="line">  --------------------------------------------------------------------------</div>
<div class="line">  jpeg          jpeg-9f            2024-01-14           1.4.0</div>
<div class="line">  nanosvg       7aeda550a8 [1]     2023-12-02           1.4.0</div>
<div class="line">  png           libpng-1.6.43      2024-02-23           1.4.0</div>
<div class="line">  zlib          zlib-1.3.1         2024-01-22           1.4.0</div>
<div class="line">  <a class="code hl_class" href="structlibdecor.html">libdecor</a>      c2bd8ad6   [2]     2024-05-31           1.4.0</div>
<div class="line">  --------------------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line">Previous versions of bundled libraries (FLTK 1.3.x):</div>
<div class="line"> </div>
<div class="line">  Library       Version            Release date         FLTK Version</div>
<div class="line">  --------------------------------------------------------------------------</div>
<div class="line">  jpeg          jpeg-9e            2022-01-16           1.3.9</div>
<div class="line">  png           libpng-1.6.40      2023-06-21           1.3.9</div>
<div class="line">  zlib          zlib-1.3           2023-08-18           1.3.9</div>
<div class="line"> </div>
<div class="line">  jpeg          jpeg-9d            2020-01-12           1.3.6 - 1.3.8</div>
<div class="line">  png           libpng-1.6.37      2019-04-14           1.3.6 - 1.3.8</div>
<div class="line">  zlib          zlib-1.2.11        2017-01-15           1.3.6 - 1.3.8</div>
<div class="line">  --------------------------------------------------------------------------</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[1] Git commit in branch <span class="stringliteral">&#39;fltk&#39;</span> of https:<span class="comment">//github.com/fltk/nanosvg</span></div>
<div class="line">    See also git tag <span class="stringliteral">&#39;fltk_yyyy-mm-dd&#39;</span> where yyyy-mm-dd == <span class="stringliteral">&quot;Release date&quot;</span></div>
<div class="line">    and file nanosvg/README.txt.</div>
<div class="line">[2] Git commit in https:<span class="comment">//gitlab.freedesktop.org/libdecor/libdecor</span></div>
<div class="ttc" id="astructlibdecor_html"><div class="ttname"><a href="structlibdecor.html">libdecor</a></div><div class="ttdoc">A libdecor context instance.</div><div class="ttdef"><b>Definition</b> libdecor.c:51</div></div>
</div><!-- fragment --><h2>General information:</h2>
<p>FLTK does not include the entire library distributions. We only provide the source files necessary to build the FLTK library and some README and/or CHANGELOG files. There are no test programs or other contributed files.</p>
<p>We use our own build files, hence a few files MUST NOT be upgraded when the library source files are upgraded. We strive to keep changes to the library source files as small as possible. Patching library code to work with FLTK should be a rare exception. Symbol prefixing with prefix 'fltk_' is one such exception to the rule.</p>
<p>If patches are necessary all changes in the library files should be marked with "FLTK" in a comment so a developer who upgrades the library later is aware of changes in the source code for FLTK. Look for 'FLTK' and/or 'fltk_' to find the differences.</p>
<p>Additional comments should be added to show the rationale, i.e. why a particular change was necessary. If applicable, add a reference to a Software Trouble Report, GitHub Issue or Pull Request (PR) like "STR 3456", "Issue #123", or "PR #234".</p>
<h1><a class="anchor" id="bundled-how-to"></a>
How to update the bundled libraries</h1>
<p>It is generally advisable to use a graphical merge program. I'm using 'meld' under Linux, but YMMV.</p>
<p>Do not add any source files unless they are required to build the library.</p>
<p>Some config header files may be pre-generated in the FLTK sources. These header files should be left untouched, but it may be necessary to update these files if new items were added to the new library version. In this case the new header should be pre-generated on a Linux system with default options unless otherwise mentioned below for a specific library. Currently there are no known exceptions.</p>
<h2>Merging source files:</h2>
<p>Please check if some source and header files contain "FLTK" comments and/or 'fltk_' symbol prefixing to be aware of necessary merges. It is also good to download the distribution tar ball or Git source files of the previous version and to run a (graphical) diff or merge tool on the previous version and the bundled version of FLTK to see the "previous" differences.</p>
<p>Files that were not patched in previous versions should be copied to the new version w/o changes. Files that had FLTK specific patches must be merged manually. FLTK patches should be verified (if still necessary) and should be kept in the new source files.</p>
<p>Source and header files that have been added in the new library version should be added in FLTK as well if they are necessary to build the library. A simple "trial and error" should be sufficient to find files that need to be added. Added files must be added to FLTK's build files as well, usually to both &lsquo;Makefile&rsquo; and &lsquo;CMakeLists.txt&rsquo; to be used in configure/make and in CMake based builds, respectively.</p>
<h2>Upgrade order:</h2>
<p>There is only one dependency between all bundled libraries: libpng depends on zlib. Hence zlib should be upgraded first, then all other libs can be upgraded in arbitrary order.</p>
<h2>Tests after merge:</h2>
<p>Tests should be done on as many platforms as possible, both with autotools (configure/make) and CMake. Windows (Visual Studio) and macOS (Xcode) builds need CMake to generate the IDE files.</p>
<h2>Upgrade notes for specific libraries:</h2>
<p>The following chapters contain informations about specific files and how they are upgraded. Since the changes in all bundled libraries are not known in advance this information may change in the future. Please verify that no other changes are necessary.</p>
<h1><a class="anchor" id="bundled-zlib"></a>
zlib:</h1>
<p>Website: <a href="https://zlib.net/">https://zlib.net/</a> <br  />
 Download: See website and follow links. <br  />
 Repository: git clone <a href="https://github.com/madler/zlib.git">https://github.com/madler/zlib.git</a></p>
<p>zlib should be upgraded first because libpng depends on zlib.</p>
<p>Download the latest zlib sources, &lsquo;cd&rsquo; to /path-to/zlib and run </p><div class="fragment"><div class="line">$ ./configure --zprefix</div>
</div><!-- fragment --><p> This creates the header file '<a class="el" href="zconf_8h_source.html">zconf.h</a>' with definitions to enable the standard 'z_' symbol prefix.</p>
<p>Unfortunately zlib requires patching some source and header files to convert this 'z_' prefix to 'fltk_z_' to be more specific. As of this writing (Nov. 2021) three files need symbol prefix patches:</p>
<ul>
<li>gzread.c</li>
<li><a class="el" href="zconf_8h_source.html">zconf.h</a></li>
<li><a class="el" href="zlib_8h_source.html">zlib.h</a></li>
</ul>
<p>You may want to compare these files and/or the previous version to find out which changes are required. The general rule is to change all occurrences of 'z_' to 'fltk_z_' but there <em>are</em> exceptions.</p>
<p>The following files need special handling:</p>
<ul>
<li>CMakeLists.txt: Keep FLTK version, update manually if necessary.</li>
<li>Makefile: Same as CMakeLists.txt.</li>
<li>gzread.c: Merge changes (see above, manual merge recommended).</li>
<li><a class="el" href="zconf_8h_source.html">zconf.h</a>: Merge changes (see above, manual merge recommended).</li>
<li><a class="el" href="zlib_8h_source.html">zlib.h</a>: Merge changes (see above, manual merge recommended).</li>
<li>makedepend: Keep this file.</li>
</ul>
<p>Run &lsquo;make depend&rsquo; in the zlib folder on a Linux system after the upgrade to update this file.</p>
<h1><a class="anchor" id="bundled-png"></a>
png:</h1>
<p>Website: <a href="http://libpng.org/pub/png/libpng.html">http://libpng.org/pub/png/libpng.html</a> <br  />
 Download: See website and follow links. <br  />
 Repository: git clone <a href="https://git.code.sf.net/p/libpng/code">https://git.code.sf.net/p/libpng/code</a> libpng</p>
<p>libpng should be upgraded after zlib because it depends on zlib.</p>
<p>Download the latest libpng sources, &lsquo;cd&rsquo; to /path-to/libpng and run </p><div class="fragment"><div class="line">$ ./configure --with-libpng-prefix=fltk_</div>
<div class="line">$ make</div>
</div><!-- fragment --><p> This creates the header files '<a class="el" href="pnglibconf_8h_source.html">pnglibconf.h</a>' and '<a class="el" href="pngprefix_8h_source.html">pngprefix.h</a>' with the 'fltk_' symbol prefix.</p>
<p>The following files need special handling:</p>
<ul>
<li>CMakeLists.txt: Keep FLTK version, update manually if necessary.</li>
<li>Makefile: Same as CMakeLists.txt.</li>
<li><a class="el" href="pnglibconf_8h_source.html">pnglibconf.h</a>: Generate on a Linux system and merge (see above).</li>
<li><a class="el" href="pngprefix_8h_source.html">pngprefix.h</a>: Generate on a Linux system and merge (see above).</li>
<li>makedepend: Keep this file.</li>
</ul>
<p>Run &lsquo;make depend&rsquo; in the png folder on a Linux system after the upgrade to update this file.</p>
<h1><a class="anchor" id="bundled-jpeg"></a>
jpeg:</h1>
<p>Website: <a href="https://ijg.org/">https://ijg.org/</a> <br  />
 Download: See website and follow links. <br  />
 Repository: N/A</p>
<p>Download the latest jpeg-xy sources on a Linux (or Unix) system, &lsquo;cd&rsquo; to /path-to/jpeg-xy and run </p><div class="fragment"><div class="line">$ ./configure</div>
<div class="line">$ make [-jN]</div>
</div><!-- fragment --><p> This builds the library and should create the static library file '.libs/libjpeg.a'.</p>
<p>Execute the following command to extract the libjpeg symbol names used to build the 'prefixed' libfltk_jpeg library: </p><div class="fragment"><div class="line">$ nm --<span class="keyword">extern</span>-only --defined-only .libs/libjpeg.a | awk <span class="stringliteral">&#39;{print $3}&#39;</span> \</div>
<div class="line">  | sed <span class="stringliteral">&#39;/^$/d&#39;</span> | sort -u | awk <span class="stringliteral">&#39;{print &quot;#define &quot;$1&quot; fltk_&quot;$1}&#39;</span> \</div>
<div class="line">  &gt; fltk_jpeg_prefix.h</div>
</div><!-- fragment --><p> This creates the header file '<a class="el" href="fltk__jpeg__prefix_8h_source.html">fltk_jpeg_prefix.h</a>' with the '# define' statements using the 'fltk_' symbol prefix.</p>
<p>The following files need special handling:</p>
<ul>
<li>CMakeLists.txt: Keep FLTK version, update manually if necessary.</li>
<li>Makefile: Same as CMakeLists.txt.</li>
<li><a class="el" href="fltk__jpeg__prefix_8h_source.html">fltk_jpeg_prefix.h</a>: Generate on a Linux system and merge (see above).</li>
<li><a class="el" href="jconfig_8h_source.html">jconfig.h</a>: keep changes flagged with <pre class="fragment">/* FLTK */ </pre> Note: more to come...</li>
<li>makedepend: Keep this file.</li>
</ul>
<p>Run &lsquo;make depend&rsquo; in the jpeg folder on a Linux system after the upgrade to update this file.</p>
<h1><a class="anchor" id="bundled-nanosvg"></a>
nanosvg:</h1>
<p>Website: <a href="https://github.com/memononen/nanosvg">https://github.com/memononen/nanosvg</a> <br  />
 Download: See website and follow links. <br  />
 Repository: git clone <a href="https://github.com/memononen/nanosvg.git">https://github.com/memononen/nanosvg.git</a> <br  />
 FLTK Fork: git clone <a href="https://github.com/fltk/nanosvg.git">https://github.com/fltk/nanosvg.git</a></p>
<p>FLTK has its own GitHub fork of the original repository (see above).</p>
<p>The intention is to update this fork from time to time so the FLTK specific patches are up-to-date with the original library. Hopefully the FLTK patches will be accepted upstream at some time in the future so we no longer need our own patches. AlbrechtS, 04 Feb 2018.</p>
<p>Update (Feb 22, 2021): The upstream library is officially no longer maintained (see README.md) although updates appear from time to time.</p>
<p>Use this fork (branch 'fltk') to get the nanosvg library with FLTK specific patches: </p><div class="fragment"><div class="line">$ git clone https:<span class="comment">//github.com/fltk/nanosvg.git nanosvg-fltk</span></div>
<div class="line">$ cd nanosvg-fltk</div>
<div class="line">$ git checkout fltk</div>
<div class="line">$ cd src</div>
<div class="line">$ cp nanosvg.h nanosvgrast.h /path/to/fltk-1.4/nanosvg/</div>
</div><!-- fragment --><p> This library does not have its own build files since it is a header-only library. The headers are included in FLTK where necessary.</p>
<p>The following files need special handling:</p>
<p><a class="el" href="nanosvg_8h_source.html">nanosvg.h</a>: Merge or download from FLTK's fork (see above). <br  />
 <a class="el" href="nanosvgrast_8h_source.html">nanosvgrast.h</a>: Merge or download from FLTK's fork (see above).</p>
<p>Maintaining branch 'fltk' in FLTK's fork of nanosvg (fltk/nanosvg):</p>
<p>Only maintainers with write access on fltk/nanosvg can do this. Others can fork our fltk/nanosvg fork in their own GitHub account and either open a PR on fltk/nanosvg or tell us about their changes in fltk.development.</p>
<p>Use something similar to the following commands to update FLTK's fork of nanosvg to the latest version. Commands are only examples, you may need to change more or less, depending on the outstanding updates.</p>
<p>Step 1: clone the fltk/nanosvg fork, set the remote 'upstream', and update the 'master' branch: </p><div class="fragment"><div class="line">$ cd /to/your/dev/dir</div>
<div class="line">$ git clone https:<span class="comment">//github.com/fltk/nanosvg.git nanosvg-fltk</span></div>
<div class="line">$ cd nanosvg-fltk</div>
<div class="line">$ git remote add upstream https:<span class="comment">//github.com/memononen/nanosvg</span></div>
<div class="line">$ git checkout master</div>
<div class="line">$ git pull upstream master</div>
</div><!-- fragment --><p> Note: the 'master' branch must never be changed, i.e. it must always be the same as 'upstream/master'. Never commit your own (FLTK specific) changes to branch 'master'.</p>
<p>Step 2: rebase branch 'fltk' on the new master (upstream/master), fix potential conflicts, and tag the new branch.</p>
<p>It is important to keep the individual FLTK specific patches intact (one commit per patch) because this will preserve the history and the committer and make it easier to skip single patches when they are accepted upstream. </p><div class="fragment"><div class="line">$ git checkout fltk</div>
<div class="line">$ git rebase upstream/master</div>
</div><!-- fragment --><p> At this point you may need to fix conflicts! Do whatever is necessary to update the branch 'fltk'.</p>
<p>Now &lsquo;git tag&rsquo; the 'fltk' branch for later reference.</p>
<p>Hint: use &lsquo;git show &lt;any-older-tag-name&gt;&rsquo; to see its contents. I like to write a summary of commits in the tag comment. </p><div class="fragment"><div class="line">$ git tag -a fltk_yyyy-mm-dd fltk</div>
</div><!-- fragment --><p> Replace 'yyyy-mm-dd' with the current date and add a comment when asked for it (your editor will open an empty file).</p>
<p>Step 3: at this point it is recommended to copy the changed header files to your working copy of the FLTK library and test the changes. If anything is wrong, go back, fix the bugs and change the git tag (delete and create a new one).</p>
<p>Step 4: push the new branch 'fltk' and the tag to the fltk/nanosvg repository: </p><div class="fragment"><div class="line">$ git push -f origin fltk</div>
<div class="line">$ git push origin fltk_yyyy-mm-dd</div>
</div><!-- fragment --><p> Step 5: copy the changed files to your working copy of the FLTK repository (if not done already), update this file accordingly, and commit/push the update to the fltk/fltk repository.</p>
<h1><a class="anchor" id="bundled-libdecor"></a>
libdecor:</h1>
<p>Website: <a href="https://gitlab.freedesktop.org/libdecor/libdecor">https://gitlab.freedesktop.org/libdecor/libdecor</a> <br  />
 Download: See website and follow links. <br  />
 Repository: git clone <a href="https://gitlab.freedesktop.org/libdecor/libdecor.git">https://gitlab.freedesktop.org/libdecor/libdecor.git</a></p>
<p>libdecor is used by the Wayland/X11 hybrid platform to draw window titlebars when FLTK apps run as Wayland clients and the running Wayland compositor uses client-side decoration. In the future, when libdecor will have made its way into Linux packages, FLTK will use the system version of libdecor. libdecor will remain as an FLTK bundle to support Linux configurations where the libdecor package is not available or not installed.</p>
<p>FLTK uses libdecor source files without any modification. This part of the libdecor source tree is copied to directory libdecor/ of the FLTK source tree: </p><pre>
    LICENSE
    README.md
    src/    ... and files below except meson.build files
</pre><p> Furthermore, directory libdecor/build/ of the FLTK source tree does not originate from the libdecor source tree but contains 3 FLTK-created files. File build/Makefile may need changes if a libdecor update adds or renames source files. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
